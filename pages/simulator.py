import streamlit as st
import numpy as np
import pandas as pd
import plotly.express as px

# --- í˜ì´ì§€ ê¸°ë³¸ ì„¤ì • ---
st.set_page_config(
    page_title="í™•ë¥  ì‹œë®¬ë ˆì´í„°",
    page_icon="ğŸ²",
    layout="centered"
)

# --- ì•± ì œëª© ë° ì„¤ëª… ---
st.title("ğŸ² í™•ë¥  ì‹œë®¬ë ˆì´í„°")
st.write("""
ë™ì „ ë˜ì§€ê¸°ì™€ ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° ì‹œë®¬ë ˆì´ì…˜ì„ í†µí•´ í™•ë¥ ì˜ ì„¸ê³„ë¥¼ íƒí—˜í•´ ë³´ì„¸ìš”.
ì‹œí–‰ íšŸìˆ˜ë¥¼ ëŠ˜ë ¤ê°€ë©´ì„œ ì‹¤í—˜ì  í™•ë¥ ì´ ìˆ˜í•™ì  í™•ë¥ ì— ì–´ë–»ê²Œ ê°€ê¹Œì›Œì§€ëŠ”ì§€ ì§ì ‘ í™•ì¸í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
ì´ê²ƒì´ ë°”ë¡œ **'í° ìˆ˜ì˜ ë²•ì¹™'**ì…ë‹ˆë‹¤!
""")

# --- ì‚¬ì´ë“œë°”: ì‚¬ìš©ì ì…ë ¥ ---
with st.sidebar:
    st.header("âš™ï¸ ì‹œë®¬ë ˆì´ì…˜ ì„¤ì •")
    
    # 1. ì‹œë®¬ë ˆì´ì…˜ ì¢…ë¥˜ ì„ íƒ
    simulation_type = st.radio(
        "ì‹œë®¬ë ˆì´ì…˜ ì¢…ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”:",
        ('ë™ì „ ë˜ì§€ê¸°', 'ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°'),
        key="simulation_type"
    )

    # 2. ì‹œí–‰ íšŸìˆ˜ ì„ íƒ (ë¡œê·¸ ìŠ¤ì¼€ì¼ ìŠ¬ë¼ì´ë”)
    # st.select_sliderëŠ” íŠ¹ì • ê°’ë“¤ ì¤‘ì—ì„œ ì„ íƒí•˜ê²Œ í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.
    num_trials = st.select_slider(
        "ì‹œí–‰ íšŸìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”:",
        options=[10, 50, 100, 500, 1000, 5000, 10000, 50000],
        value=1000 # ê¸°ë³¸ê°’
    )

    # 3. ì‹¤í–‰ ë²„íŠ¼
    run_button = st.button("ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰", type="primary")


# --- ë©”ì¸ í™”ë©´: ê²°ê³¼ í‘œì‹œ ---
if run_button:
    st.subheader(f"ê²°ê³¼: {simulation_type} {num_trials}íšŒ ì‹œí–‰")

    # --- ë™ì „ ë˜ì§€ê¸° ì‹œë®¬ë ˆì´ì…˜ ---
    if simulation_type == 'ë™ì „ ë˜ì§€ê¸°':
        # 1. ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰: 'ì•ë©´', 'ë’·ë©´' ì¤‘ num_trials ë§Œí¼ ëœë¤ ì„ íƒ
        outcomes = np.random.choice(['ì•ë©´', 'ë’·ë©´'], size=num_trials)
        
        # 2. ê²°ê³¼ ì§‘ê³„: ê° ê²°ê³¼ê°€ ëª‡ ë²ˆ ë‚˜ì™”ëŠ”ì§€ ê³„ì‚°
        counts = pd.Series(outcomes).value_counts().reindex(['ì•ë©´', 'ë’·ë©´'], fill_value=0)
        
        # 3. ê²°ê³¼ ì‹œê°í™” (ë§‰ëŒ€ ê·¸ë˜í”„)
        st.bar_chart(counts)
        
        # 4. í™•ë¥  ê³„ì‚° ë° ë¹„êµ
        st.subheader("ğŸ“Š í™•ë¥  ë¹„êµ")
        
        # ì‹¤í—˜ì /ì´ë¡ ì  í™•ë¥ ì„ ë‹´ì„ ë°ì´í„°í”„ë ˆì„ ìƒì„±
        prob_df = pd.DataFrame({
            'ê²°ê³¼': ['ì•ë©´', 'ë’·ë©´'],
            'íšŸìˆ˜': counts.values,
            'ì‹¤í—˜ì  í™•ë¥ ': (counts / num_trials).values,
            'ìˆ˜í•™ì  í™•ë¥ ': [0.5, 0.5]
        })
        
        # ë°ì´í„°í”„ë ˆì„ ìŠ¤íƒ€ì¼ë§ ë° í‘œì‹œ
        st.dataframe(prob_df.style.format({
            'ì‹¤í—˜ì  í™•ë¥ ': '{:.2%}',
            'ìˆ˜í•™ì  í™•ë¥ ': '{:.2%}'
        }), use_container_width=True)

    # --- ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° ì‹œë®¬ë ˆì´ì…˜ ---
    elif simulation_type == 'ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°':
        # 1. ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰: 1~6 ì‚¬ì´ì˜ ì •ìˆ˜ë¥¼ num_trials ë§Œí¼ ëœë¤ ì„ íƒ
        outcomes = np.random.randint(1, 7, size=num_trials)
        
        # 2. ê²°ê³¼ ì§‘ê³„: 1~6ê¹Œì§€ ê° ìˆ«ìê°€ ëª‡ ë²ˆ ë‚˜ì™”ëŠ”ì§€ ê³„ì‚°í•˜ê³ , ì¸ë±ìŠ¤(ëˆˆ) ìˆœì„œëŒ€ë¡œ ì •ë ¬
        counts = pd.Series(outcomes).value_counts().reindex(range(1, 7), fill_value=0).sort_index()
        
        # 3. ê²°ê³¼ ì‹œê°í™” (ë§‰ëŒ€ ê·¸ë˜í”„)
        st.bar_chart(counts)

        # 4. í™•ë¥  ê³„ì‚° ë° ë¹„êµ
        st.subheader("ğŸ“Š í™•ë¥  ë¹„êµ")

        # ì‹¤í—˜ì /ì´ë¡ ì  í™•ë¥ ì„ ë‹´ì„ ë°ì´í„°í”„ë ˆì„ ìƒì„±
        prob_df = pd.DataFrame({
            'ëˆˆ(ê²°ê³¼)': counts.index,
            'íšŸìˆ˜': counts.values,
            'ì‹¤í—˜ì  í™•ë¥ ': (counts / num_trials).values,
            'ìˆ˜í•™ì  í™•ë¥ ': [1/6] * 6
        })
        
        # ë°ì´í„°í”„ë ˆì„ ìŠ¤íƒ€ì¼ë§ ë° í‘œì‹œ
        st.dataframe(prob_df.style.format({
            'ì‹¤í—˜ì  í™•ë¥ ': '{:.2%}',
            'ìˆ˜í•™ì  í™•ë¥ ': '{:.2%}'
        }), use_container_width=True)

else:
    # ì•±ì´ ì²˜ìŒ ì‹¤í–‰ë˜ì—ˆì„ ë•Œ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
    st.info("ğŸ‘ˆ ì™¼ìª½ ì‚¬ì´ë“œë°”ì—ì„œ ì„¤ì •ì„ ë§ˆì¹œ í›„ 'ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.")